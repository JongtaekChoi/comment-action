name: Review Comment Format Checker

on:
  pull_request_review_comment:
    types: [created, edited]

jobs:
  check-comment-format:
    permissions:
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - name: Check format of review comment
        uses: actions/github-script@v7
        with:
          script: |
            const comment = context.payload.comment.body;
            const regex = /^[pP][1-5]/;
            if (context.payload.comment.in_reply_to_id) {
              console.log('코멘트의 코멘트는 아무것도 안함')
              return;
            }

            if (!regex.test(comment)) {
              const commentID = context.payload.comment.id;
              const message = `🚨 @${context.payload.comment.user.login}, Pn 룰을 따르지 않는 코멘트입니다.`;

              github.rest.pulls.createReplyForReviewComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: context.payload.pull_request.id,
                comment_id: commentID,
                body: message
              });
            }
